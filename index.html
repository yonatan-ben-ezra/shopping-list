<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>רשימת הקניות שלי</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4a90e2; 
            --accent: #50e3c2;
            --dark: #2C3A47;
            --bg: #f0f2f5;
            --glass: rgba(255, 255, 255, 0.98);
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
            --danger: #ff6b6b;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Rubik', sans-serif;
            background: var(--bg);
            color: var(--dark);
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- מסך בית --- */
        #homeView {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .home-header { text-align: center; margin-bottom: 20px; }
        .home-header h1 { margin: 0; color: var(--primary); font-size: 2rem; }
        .home-header p { margin: 5px 0 0; color: #888; }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .cat-card {
            background: white;
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1/1;
        }

        .cat-card:active { transform: scale(0.95); }
        .cat-card i { font-size: 2.2rem; margin-bottom: 10px; color: var(--primary); }
        .cat-card h3 { margin: 0; font-size: 1rem; font-weight: 600; }
        
        /* עיצוב ייחודי למלבן העליון */
        .cat-card.all-cats {
            background: linear-gradient(135deg, var(--primary), #357abd);
            color: white;
            grid-column: span 2;
            aspect-ratio: auto;
            padding: 25px;
            flex-direction: row;
            gap: 15px;
        }
        .cat-card.all-cats i { color: white; margin: 0; font-size: 1.8rem; }
        .cat-card.all-cats h3 { font-size: 1.3rem; }

        /* כרטיס המשימות */
        .cat-card.tasks-card { border-bottom: 4px solid var(--accent); }
        /* כרטיס המוצרים שלי */
        .cat-card.my-card { border-bottom: 4px solid var(--primary); background: #fdfdfd; }

        /* --- מסך פנימי --- */
        #categoryView {
            display: none;
            flex-direction: column;
            height: 100%;
            background: #fff;
        }

        .sticky-section {
            background: var(--glass);
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            z-index: 10;
            border-bottom: 1px solid #eee;
        }

        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .back-btn { background: #eee; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .view-title { font-size: 1.2rem; font-weight: 800; color: var(--primary); }

        .add-form { display: flex; flex-direction: column; gap: 10px; }
        .input-row { display: flex; gap: 10px; }
        
        select, input, textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            background: #f9f9f9;
        }
        
        select { width: 100%; }
        #itemName { flex-grow: 1; }
        #itemQty { width: 70px; text-align: center; }
        
        .add-btn {
            background: var(--accent); color: var(--dark); border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer;
            box-shadow: 0 4px 10px rgba(80, 227, 194, 0.3);
        }

        #listScrollArea { flex-grow: 1; overflow-y: auto; padding: 15px; background: #fcfcfc; padding-bottom: 50px; }

        .sub-group-title {
            font-size: 0.9rem; color: #888; margin: 25px 0 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; font-weight: bold;
        }

        .product-item {
            background: white; border-radius: 12px; padding: 10px; margin-bottom: 10px; display: flex; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03); transition: all 0.2s;
        }

        .qty-circle {
            width: 35px; height: 35px; background: var(--primary); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-weight: bold; margin-left: 10px; flex-shrink: 0; font-size: 0.9rem;
        }

        .item-content { flex-grow: 1; cursor: pointer; }
        .item-name { font-weight: 600; font-size: 1.1rem; }
        .item-note { font-size: 0.85rem; color: #666; background: #f0f0f0; padding: 5px 10px; border-radius: 6px; margin-top: 5px; display: none; }
        .global-badge { color: gold; font-size: 0.8rem; margin-right: 5px; }

        .delete-btn {
            background: #ffecec; color: var(--danger); border: none; width: 30px; height: 30px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; margin-right: 10px; cursor: pointer;
        }

        .admin-float {
            position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); padding: 5px 10px;
            border-radius: 20px; font-size: 0.8rem; border: none; backdrop-filter: blur(5px); z-index: 5;
        }

        /* מודאלים */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; max-height: 80vh; overflow-y: auto; }
        .close-modal { float: right; font-size: 1.5rem; cursor: pointer; }

        /* עיצוב עורך הקטגוריות החדש */
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; justify-content: center; }
        .tag-chip { 
            background: #f0f2f5; padding: 5px 10px; border-radius: 15px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; 
        }
        .tag-chip i { color: var(--danger); cursor: pointer; }
        .editor-section { border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px; }
    </style>
</head>
<body>

<div id="homeView">
    <button class="admin-float" onclick="openAdminLogin()"><i class="fas fa-user-shield"></i> מנהל</button>
    
    <div class="home-header">
        <h1>הקניות שלנו</h1>
        <p>בחר קטגוריה</p>
    </div>

    <div class="grid-container" id="categoryGrid">
        </div>
</div>

<div id="categoryView">
    <div class="sticky-section">
        <div class="view-header">
            <button class="back-btn" onclick="backToHome()"><i class="fas fa-arrow-right"></i> חזרה</button>
            <div class="view-title" id="viewTitle">שם הקטגוריה</div>
            <div style="width: 60px;"></div>
        </div>

        <div class="add-form" id="addForm">
            <select id="subCatSelect"></select>
            <div class="input-row">
                <input type="text" id="itemName" placeholder="שם מוצר/משימה...">
                <input type="number" id="itemQty" placeholder="כמות" value="1" min="1">
            </div>
            <textarea id="itemNote" rows="1" placeholder="הערה (אופציונלי)" style="resize: none;"></textarea>
            <button class="add-btn" onclick="addItem()">הוסף לרשימה <i class="fas fa-plus"></i></button>
        </div>
        <div id="lockedMsg" style="display:none; color:red; text-align:center; margin-top:5px;">הרשימה נעולה</div>
    </div>

    <div id="listScrollArea">
        </div>
</div>

<div id="passwordModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('passwordModal')">&times;</span>
        <h3>כניסת מנהל</h3>
        <input type="password" id="adminPass" placeholder="סיסמה" style="width:100%; margin:15px 0;">
        <button class="add-btn" onclick="checkPass()">כניסה</button>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('settingsModal')">&times;</span>
        <h3><i class="fas fa-cog"></i> ניהול קטגוריות</h3>
        
        <div class="editor-section">
            <label>בחר קטגוריה לעריכה:</label>
            <select id="editorCatSelect" onchange="renderEditorSubs()"></select>
        </div>

        <div class="editor-section" id="subsEditorArea" style="display:none;">
            <h4>תתי קטגוריות קיימות:</h4>
            <div class="tags-container" id="editorTags"></div>
            
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input type="text" id="newSubInput" placeholder="תת קטגוריה חדשה...">
                <button onclick="addNewSub()" style="background:var(--primary); color:white; border:none; border-radius:8px; width:40px;"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div class="editor-section">
            <button class="add-btn" onclick="toggleLock()" style="background:#ff6b6b; width:100%;">נעל/פתח הוספת מוצרים</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // הגדרות Firebase שלך (נשמר מהקובץ הקודם)
    const firebaseConfig = {
        apiKey: "AIzaSyAoXUKwnQpcxyZdYCT9PUh-yjmOj6kugTQ",
        authDomain: "family-shopping-891f7.firebaseapp.com",
        databaseURL: "https://family-shopping-891f7-default-rtdb.firebaseio.com",
        projectId: "family-shopping-891f7",
        storageBucket: "family-shopping-891f7.firebasestorage.app",
        messagingSenderId: "16936955736",
        appId: "1:16936955736:web:dca42916750112b7787f2d",
        measurementId: "G-QPL3C428RN"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // זיהוי משתמש
    let userId = localStorage.getItem('shop_uid');
    if(!userId) {
        userId = 'user_' + Math.random().toString(36).substr(2, 5);
        localStorage.setItem('shop_uid', userId);
    }

    let isAdmin = false;
    let currentViewKey = null;
    let allData = {};
    let appSettings = {};

    // --- מבנה הקטגוריות (לפי בקשתך) ---
    // הסדר כאן חשוב לשמירה ב-DB, אבל התצוגה נקבעת ב-renderHome
    const defaultCats = {
        osher_ad: { 
            label: "אושר עד", icon: "fa-cart-shopping", 
            subs: ["פירות וירקות", "קפואים", "סלטים", "מוצרי חלב", "מצרכים", "חד פעמי", "ניקיון", "אחר"] 
        },
        tambour: { 
            label: "טמבור", icon: "fa-screwdriver-wrench", 
            subs: ["חשמל", "כלי עבודה", "פרזול", "חומרי מליטה", "אחר"] 
        },
        max_stock: { 
            label: "מקס סטוק", icon: "fa-box-open", 
            subs: ["אחר"] 
        },
        other: { 
            label: "אחר", icon: "fa-star", 
            subs: ["כללי"] 
        },
        tasks: {
            label: "משימות", icon: "fa-list-check",
            subs: ["לביצוע", "דחוף"]
        }
    };

    // --- טעינת נתונים ---
    const settingsRef = ref(db, 'settings');
    onValue(settingsRef, (snap) => {
        const val = snap.val();
        if (!val) {
            set(settingsRef, { categories: defaultCats, locked: false, pass: "1234" });
            return;
        }
        appSettings = val;
        // עדכון מבנה אם חסר (למשל משימות)
        if(!appSettings.categories.tasks) {
             update(ref(db, 'settings/categories'), { tasks: defaultCats.tasks });
        }
        
        renderHome();
        if (currentViewKey) renderList();
    });

    onValue(ref(db, 'shoppingList'), (snap) => {
        allData = snap.val() || {};
        if (currentViewKey) renderList();
    });

    // --- מסך הבית וניווט ---
    function renderHome() {
        const grid = document.getElementById('categoryGrid');
        grid.innerHTML = "";

        // 1. כל הקטגוריות (למעלה)
        const allBtn = document.createElement('div');
        allBtn.className = 'cat-card all-cats';
        allBtn.innerHTML = `<i class="fas fa-layer-group"></i><h3>כל הקטגוריות</h3>`;
        allBtn.onclick = () => openCategory('all_view');
        grid.appendChild(allBtn);

        const cats = appSettings.categories || defaultCats;

        // פונקציית עזר ליצירת כרטיס
        const createCard = (key, data, customClass = '') => {
            const card = document.createElement('div');
            card.className = `cat-card ${customClass}`;
            card.innerHTML = `<i class="fas ${data.icon || 'fa-circle'}"></i><h3>${data.label}</h3>`;
            card.onclick = () => openCategory(key);
            grid.appendChild(card);
        };

        // 2. סדר ספציפי לפי הבקשה
        if(cats.osher_ad) createCard('osher_ad', cats.osher_ad);
        if(cats.tambour) createCard('tambour', cats.tambour);
        if(cats.max_stock) createCard('max_stock', cats.max_stock);
        if(cats.other) createCard('other', cats.other);
        
        // 3. משימות
        if(cats.tasks) createCard('tasks', cats.tasks, 'tasks-card');

        // 4. המוצרים שהוספתי (כפתור מיוחד)
        const myCard = document.createElement('div');
        myCard.className = 'cat-card my-card';
        myCard.innerHTML = `<i class="fas fa-user-tag"></i><h3>המוצרים שהוספתי</h3>`;
        myCard.onclick = () => openCategory('my_added');
        grid.appendChild(myCard);

        // כפתור עריכה למנהל
        if(isAdmin) {
            const editBtn = document.createElement('div');
            editBtn.className = 'cat-card';
            editBtn.style.background = '#eee';
            editBtn.innerHTML = '<i class="fas fa-cog"></i><h3>הגדרות</h3>';
            editBtn.onclick = openSettingsUI;
            grid.appendChild(editBtn);
        }
    }

    window.openCategory = function(key) {
        currentViewKey = key;
        document.getElementById('homeView').style.display = 'none';
        document.getElementById('categoryView').style.display = 'flex';
        
        const subSelect = document.getElementById('subCatSelect');
        subSelect.innerHTML = "";
        const formDiv = document.getElementById('addForm');

        // כותרת והגדרות תצוגה
        if (key === 'all_view') {
            document.getElementById('viewTitle').innerText = "כל הקטגוריות";
            const opt = document.createElement('option');
            opt.value = "global";
            opt.innerText = "כללי (יופיע בכל הרשימות)";
            subSelect.appendChild(opt);
            formDiv.style.visibility = "visible";
        
        } else if (key === 'my_added') {
            document.getElementById('viewTitle').innerText = "המוצרים שהוספתי";
            formDiv.style.visibility = "hidden"; // אי אפשר להוסיף כאן, רק לצפות
        
        } else {
            // קטגוריה רגילה (כולל משימות)
            const catData = (appSettings.categories || defaultCats)[key];
            document.getElementById('viewTitle').innerText = catData.label;
            formDiv.style.visibility = "visible";
            
            if (catData.subs) {
                catData.subs.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.innerText = sub;
                    subSelect.appendChild(opt);
                });
            }
        }
        
        // נעילה
        const locked = appSettings.locked && !isAdmin;
        // אם אנחנו במצב צפייה בלבד (המוצרים שלי), אין משמעות לנעילה
        if (key !== 'my_added') {
            formDiv.style.display = locked ? 'none' : 'flex';
            document.getElementById('lockedMsg').style.display = locked ? 'block' : 'none';
        } else {
            formDiv.style.display = 'none'; // תמיד מוסתר ב"מוצרים שלי"
            document.getElementById('lockedMsg').style.display = 'none';
        }

        renderList();
    }

    window.backToHome = function() {
        currentViewKey = null;
        document.getElementById('categoryView').style.display = 'none';
        document.getElementById('homeView').style.display = 'flex';
    }

    function renderList() {
        const container = document.getElementById('listScrollArea');
        container.innerHTML = "";
        
        const items = Object.entries(allData).map(([id, val]) => ({ id, ...val }));
        const cats = appSettings.categories || defaultCats;

        // סינון הפריטים
        let filteredItems = [];

        if (currentViewKey === 'all_view') {
            // הצג הכל
            filteredItems = items;
        } else if (currentViewKey === 'my_added') {
            // רק מה שאני הוספתי
            filteredItems = items.filter(i => i.owner === userId);
        } else if (currentViewKey === 'tasks') {
            // רק משימות (בלי גלובלי)
            filteredItems = items.filter(i => i.mainCat === 'tasks');
        } else {
            // קטגוריה ספציפית: פריטים שלה + פריטים גלובליים
            filteredItems = items.filter(i => 
                i.mainCat === currentViewKey || i.mainCat === 'global'
            );
        }

        if (filteredItems.length === 0) {
            container.innerHTML = '<div style="text-align:center; margin-top:30px; color:#aaa;">הקטגוריה ריקה</div>';
            return;
        }

        // קיבוץ (Grouping)
        const grouped = {};

        filteredItems.forEach(item => {
            let groupKey = "";

            if (currentViewKey === 'my_added') {
                // ב"מוצרים שלי" - הכותרת היא הקטגוריה הראשית
                if (item.mainCat === 'global') groupKey = "כללי";
                else if (cats[item.mainCat]) groupKey = cats[item.mainCat].label;
                else groupKey = "אחר";
            } else if (currentViewKey === 'all_view') {
                 // ב"הכל" - הכותרת היא הקטגוריה הראשית
                 if (item.mainCat === 'global') groupKey = "פריטים גלובליים";
                 else if (cats[item.mainCat]) groupKey = cats[item.mainCat].label;
                 else groupKey = "אחר";
            } else {
                // בתוך קטגוריה רגילה - כותרת היא תת הקטגוריה
                if (item.mainCat === 'global') groupKey = "zzz_global"; // טריק למיון: שיופיע בסוף
                else groupKey = item.subCat;
            }

            if (!grouped[groupKey]) grouped[groupKey] = [];
            grouped[groupKey].push(item);
        });

        // מיון המפתחות (כדי שהגלובלי יופיע בסוף בקטגוריות רגילות)
        const sortedKeys = Object.keys(grouped).sort();

        sortedKeys.forEach(key => {
            const itemsInGroup = grouped[key];
            const headerDiv = document.createElement('div');
            headerDiv.className = 'sub-group-title';
            
            // תצוגת שם הכותרת
            if (key === 'zzz_global') headerDiv.innerText = "כללי (בכל הרשימות)";
            else headerDiv.innerText = key;

            container.appendChild(headerDiv);

            itemsInGroup.forEach(item => {
                const div = document.createElement('div');
                div.className = 'product-item';
                
                const canDelete = isAdmin || item.owner === userId;
                const deleteHtml = canDelete ? 
                    `<button class="delete-btn" onclick="deleteItem('${item.id}')"><i class="fas fa-trash"></i></button>` : 
                    `<div style="width:40px;"></div>`;

                const isGlobal = item.mainCat === 'global';
                const noteHtml = item.note ? `<div class="item-note" id="note-${item.id}">${item.note}</div>` : '';
                const globalIcon = isGlobal ? '<i class="fas fa-star global-badge"></i>' : '';

                div.innerHTML = `
                    ${deleteHtml}
                    <div class="item-content" onclick="toggleNote('${item.id}')">
                        <div class="item-name">${globalIcon}${item.name}</div>
                        ${noteHtml}
                    </div>
                    <div class="qty-circle">${item.qty}</div>
                `;
                container.appendChild(div);
            });
        });
    }

    // --- פעולות הוספה ומחיקה ---
    window.addItem = function() {
        const name = document.getElementById('itemName').value;
        const qty = document.getElementById('itemQty').value;
        const sub = document.getElementById('subCatSelect').value;
        const note = document.getElementById('itemNote').value;

        if (!name.trim()) return;

        let mainCat = currentViewKey;
        // ב"כל הקטגוריות", הראשי הוא גלובל
        if (currentViewKey === 'all_view') mainCat = 'global';

        push(ref(db, 'shoppingList'), {
            name: name,
            qty: qty,
            mainCat: mainCat,
            subCat: sub, 
            note: note,
            owner: userId,
            created: Date.now()
        });

        document.getElementById('itemName').value = "";
        document.getElementById('itemNote').value = "";
        document.getElementById('itemQty').value = "1";
    }

    window.deleteItem = function(id) {
        if(confirm("למחוק את הפריט?")) {
            remove(ref(db, `shoppingList/${id}`));
        }
    }

    window.toggleNote = function(id) {
        const el = document.getElementById(`note-${id}`);
        if(el) el.style.display = el.style.display === 'none' || el.style.display === '' ? 'block' : 'none';
    }

    // --- ניהול וממשק מנהל ---
    window.openAdminLogin = function() {
        if(isAdmin) { 
            isAdmin = false;
            alert("התנתקת");
            renderHome();
            return;
        }
        document.getElementById('passwordModal').style.display = 'flex';
    }

    window.checkPass = function() {
        const inp = document.getElementById('adminPass').value;
        if (inp === (appSettings.pass || "1234")) {
            isAdmin = true;
            document.getElementById('passwordModal').style.display = 'none';
            alert("מחובר כמנהל");
            renderHome();
        } else {
            alert("סיסמה שגויה");
        }
    }

    // --- עורך קטגוריות משופר (UI) ---
    window.openSettingsUI = function() {
        const modal = document.getElementById('settingsModal');
        const select = document.getElementById('editorCatSelect');
        select.innerHTML = '<option value="">בחר...</option>';
        
        Object.entries(appSettings.categories).forEach(([key, val]) => {
            const op = document.createElement('option');
            op.value = key;
            op.innerText = val.label;
            select.appendChild(op);
        });

        document.getElementById('subsEditorArea').style.display = 'none';
        modal.style.display = 'flex';
    }

    window.renderEditorSubs = function() {
        const key = document.getElementById('editorCatSelect').value;
        const area = document.getElementById('subsEditorArea');
        const tagsDiv = document.getElementById('editorTags');
        
        if(!key) { area.style.display = 'none'; return; }
        
        area.style.display = 'block';
        tagsDiv.innerHTML = "";
        
        const subs = appSettings.categories[key].subs || [];
        subs.forEach(sub => {
            const tag = document.createElement('div');
            tag.className = 'tag-chip';
            tag.innerHTML = `${sub} <i class="fas fa-times-circle" onclick="removeSub('${key}', '${sub}')"></i>`;
            tagsDiv.appendChild(tag);
        });
    }

    window.addNewSub = function() {
        const key = document.getElementById('editorCatSelect').value;
        const input = document.getElementById('newSubInput');
        const newSub = input.value.trim();
        
        if(!newSub) return;
        
        const currentSubs = appSettings.categories[key].subs || [];
        if(!currentSubs.includes(newSub)) {
            const updatedSubs = [...currentSubs, newSub];
            update(ref(db, `settings/categories/${key}`), { subs: updatedSubs });
            input.value = "";
            // העדכון מ-Firebase יגרום לרענון אוטומטי של המסך דרך onValue
            setTimeout(() => { 
                document.getElementById('editorCatSelect').value = key; // שמירת הבחירה
                renderEditorSubs(); 
            }, 300);
        }
    }

    window.removeSub = function(key, subToRemove) {
        if(!confirm(`למחוק את ${subToRemove}?`)) return;
        const currentSubs = appSettings.categories[key].subs || [];
        const updatedSubs = currentSubs.filter(s => s !== subToRemove);
        update(ref(db, `settings/categories/${key}`), { subs: updatedSubs });
        setTimeout(() => { 
             document.getElementById('editorCatSelect').value = key;
             renderEditorSubs(); 
        }, 300);
    }

    window.toggleLock = function() {
        const newLock = !appSettings.locked;
        update(ref(db, 'settings'), { locked: newLock });
        alert(newLock ? "רשימה ננעלה" : "רשימה נפתחה");
        document.getElementById('settingsModal').style.display = 'none';
    }

    window.closeModal = (id) => document.getElementById(id).style.display = 'none';
</script>

</body>
</html>
